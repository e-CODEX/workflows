name: Detect Project - NPM or Maven

on:
  workflow_call:
    
    outputs:
      project_type:
        description: "Detected project type: maven | npm | both | none"
        value: ${{ jobs.detect.outputs.project_type }}

jobs:
  detect:
    runs-on: ubuntu-latest
    outputs:
      project_type: ${{ steps.check.outputs.project_type }}
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.sha }}
          token: ${{ secrets.ctp_PAT_TOKEN }}
          fetch-depth: 0

      - id: check
        shell: bash
        run: |
          ls
          # Derive project_type
          if [ -f "pom.xml" ] && [ -f "package.json" ]; then
            project_type="both"
          elif [ -f "pom.xml" ]; then
            project_type="maven"
          elif [ -f "package.json" ]; then
            project_type="npm"
          else
            echo "No recognized project files found (pom.xml or package.json)."
            exit 1
          fi
          echo "Detected project type: $project_type"
          echo "project_type=$project_type" >> "$GITHUB_OUTPUT"
