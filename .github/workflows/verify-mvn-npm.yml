name: Detect Project - NPM or Maven

on:
  workflow_call:
    outputs:
      has_pom:
        description: "Whether pom.xml exists in the given path"
        value: ${{ jobs.detect.outputs.has_pom }}
      has_package_json:
        description: "Whether package.json exists in the given path"
        value: ${{ jobs.detect.outputs.has_package_json }}
      project_type:
        description: "Detected project type: maven | npm | both | none"
        value: ${{ jobs.detect.outputs.project_type }}

jobs:
  detect:
    runs-on: ubuntu-latest
    outputs:
      has_pom: ${{ steps.check.outputs.has_pom }}
      has_package_json: ${{ steps.check.outputs.has_package_json }}
      project_type: ${{ steps.check.outputs.project_type }}
    steps:
      - uses: actions/checkout@v4

      - id: check
        shell: bash
        run: |
          # Derive project_type
          if [ -f "pom.xml" ] && [ -f "package.json" ]; then
            project_type="both"
          elif [ -f "pom.xml" ]; then
            project_type="maven"
          elif [ -f "package.json" ]; then
            project_type="npm"
          else
            echo "No recognized project files found (pom.xml or package.json)."
            exit 1
          fi
          
          echo "project_type=$project_type" >> "$GITHUB_OUTPUT"
