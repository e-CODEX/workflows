name: Detect Project - NPM or Maven

on:
  workflow_call:
    inputs:
      branch:
        description: "Branch name to use for the detection (for checkout)"
        required: false
        type: string
        default: "main"
    outputs:
      project_type:
        description: "Detected project type: maven | npm | both | none"
        value: ${{ jobs.detect.outputs.project_type }}

jobs:
  detect:
    runs-on: ubuntu-latest
    outputs:
      project_type: ${{ steps.check.outputs.project_type }}
    steps:
      - uses: actions/checkout@v4
        with:
          repository: e-CODEX/ctp
          ref: ${{ github.event.inputs.branch }}
          fetch-depth: 0
          token: ${{ secrets.ctp_PAT_TOKEN }}

      - id: check
        shell: bash
        run: |
          ls
          # Derive project_type
          if [ -f "pom.xml" ] && [ -f "package.json" ]; then
            project_type="both"
          elif [ -f "pom.xml" ]; then
            project_type="maven"
          elif [ -f "package.json" ]; then
            project_type="npm"
          else
            echo "No recognized project files found (pom.xml or package.json)."
            exit 1
          fi
          echo "Detected project type: $project_type"
          echo "project_type=$project_type" >> "$GITHUB_OUTPUT"
